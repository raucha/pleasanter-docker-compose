name: build and test

on: 
  push:
#   schedule:
#     - cron: '* 10 * * *'

jobs:
  job_build_and_test:
    name: build_docker_image
    runs-on: ubuntu-latest
    steps: 
      - uses: actions/checkout@v2
      - run: ls ${{ github.workspace }}
#       - run: docker-compose build -f ./docker-compose.yml
      - name: Build docker-compose
        run: docker-compose build
# #       - run: docker save pleasanter > /tmp/docker-image.tar
# #       - uses: actions/upload-artifact@v2
# #         with:
# #           name: docker-image
# #           path: /tmp/docker-image.tar
#   job_connection_test:
#     name: connection_test
#     runs-on: ubuntu-latest
#     needs: job_build
#     steps:
# #       - name: Download Docker Image (Artifact)
# #         uses: actions/download-artifact@v2
# #         with:
# #           name: docker-image
# #           path: /tmp/docker-image.tar
#       - uses: actions/checkout@v2
      - name: Launch docker-compose
        run: docker-compose up -d
      - name: Test connection
        run: |
          sleep 60
          ./test/test.bash
      - id: suc_date
        run: echo "##[set-output name=data;]$(date +'%Y-%m-%d_%H-%M-%S')"
      - name: Time badge
        uses: RubbaBoy/BYOB@v1.2.1
        with:
          NAME: suc_time
          LABEL: 'テスト成功 at'
          STATUS: ${{ steps.suc_date.outputs.data }}
          COLOR: blue
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
  job_testdate_badge:
    runs-on: ubuntu-latest
    steps:
      - id: date
        run: echo "##[set-output name=data;]$(date +'%Y-%m-%d_%H-%M-%S')"
      - name: Time badge
        uses: RubbaBoy/BYOB@v1.2.1
        with:
          NAME: time
          LABEL: 'テスト実施 at'
          STATUS: ${{ steps.date.outputs.data }}
          COLOR: blue
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

# jobs:
#   job_1:
#     name: Add 3 and 7
#     runs-on: ubuntu-latest
#     steps:
#       - shell: bash
#         run: |
#           expr 3 + 7 > math-homework.txt
#       - name: Upload math result for job 1
#         uses: actions/upload-artifact@v2
#         with:
#           name: homework
#           path: math-homework.txt

#   job_2:
#     name: Multiply by 9
#     needs: job_1
#     runs-on: windows-latest
#     steps:
#       - name: Download math result for job 1
#         uses: actions/download-artifact@v2
#         with:
#           name: homework
#       - shell: bash
#         run: |
#           value=`cat math-homework.txt`
#           expr $value \* 9 > math-homework.txt
#       - name: Upload math result for job 2
#         uses: actions/upload-artifact@v2
#         with:
#           name: homework
#           path: math-homework.txt

#   job_3:
#     name: Display results
#     needs: job_2
#     runs-on: macOS-latest
#     steps:
#       - name: Download math result for job 2
#         uses: actions/download-artifact@v2
#         with:
#           name: homework
#       - name: Print the final result
#         shell: bash
#         run: |
#           value=`cat math-homework.txt`
#           echo The result is $value
